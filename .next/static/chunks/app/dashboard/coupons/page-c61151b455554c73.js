(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[762],{4910:function(e,t,s){Promise.resolve().then(s.bind(s,9359))},9359:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return M}});var a=s(7437),r=s(2265),l=s(9501),c=s(3842),i=s(4422),n=s(429),d=s(5476),o=s(5540),u=s(9556),x=s(4430),p=s(9397),m=s(9089),h=s(9205);let y=(0,h.Z)("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);var g=s(1047),f=s(5868);let j=(0,h.Z)("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),v=(0,h.Z)("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);var N=s(8930);let b=(0,h.Z)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),w=(0,h.Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);var k=s(5252);let C=i.Ry({code:i.Z_().required("Coupon code is required").min(3,"Code must be at least 3 characters"),discountType:i.Z_().required("Discount type is required"),discountValue:i.Rx().min(0,"Discount value must be positive").required("Discount value is required"),startDate:i.Z_().required("Start date is required"),expiryDate:i.Z_().required("Expiry date is required"),minOrderValue:i.Rx().min(0,"Minimum order value must be non-negative"),maxUsageCount:i.Rx().min(1,"Max usage count must be at least 1").required("Max usage count is required")}),D=[{value:"flat",label:"Flat Amount (₹)"},{value:"percentage",label:"Percentage (%)"}];function M(){let[e,t]=(0,r.useState)([]),[s,i]=(0,r.useState)([]),[h,M]=(0,r.useState)(!0),[S,U]=(0,r.useState)(!1),[Z,V]=(0,r.useState)(!1),[T,A]=(0,r.useState)(null),[O,q]=(0,r.useState)(""),[E,_]=(0,r.useState)(!1),{addToast:$}=(0,u.p)(),{register:L,handleSubmit:P,formState:{errors:F},reset:R,setValue:I,watch:z}=(0,l.cI)({resolver:(0,c.X)(C)}),H=z("discountType");(0,r.useEffect)(()=>{W()},[]);let W=async()=>{try{let[e,s]=await Promise.all([o.M.getCoupons(),o.M.getCouponUsages()]);t(e),i(s)}catch(e){$({title:"Error",description:"Failed to load coupon data",type:"error"})}finally{M(!1)}},X=e=>{I("code",e.code),I("discountType",e.discountType),I("discountValue",e.discountValue),I("startDate",new Date(e.startDate).toISOString().split("T")[0]),I("expiryDate",new Date(e.expiryDate).toISOString().split("T")[0]),I("minOrderValue",e.minOrderValue||0),I("maxUsageCount",e.maxUsageCount),A(e),U(!0)},B=async e=>{_(!0);try{let t={...e,startDate:new Date(e.startDate),expiryDate:new Date(e.expiryDate),currentUsage:T?.currentUsage||0,isActive:T?.isActive??!0};T?(await o.M.updateCoupon(T.id,t),$({title:"Success",description:"Coupon updated successfully",type:"success"})):(await o.M.createCoupon(t),$({title:"Success",description:"Coupon created successfully",type:"success"})),await W(),U(!1),R(),A(null)}catch(e){$({title:"Error",description:"Failed to save coupon",type:"error"})}finally{_(!1)}},G=async e=>{try{await o.M.updateCoupon(e.id,{isActive:!e.isActive}),$({title:"Success",description:`Coupon ${e.isActive?"deactivated":"activated"} successfully`,type:"success"}),await W()}catch(e){$({title:"Error",description:"Failed to update coupon status",type:"error"})}},J=async e=>{if(confirm(`Are you sure you want to delete coupon ${e.code}?`))try{await o.M.deleteCoupon(e.id),$({title:"Success",description:"Coupon deleted successfully",type:"success"}),await W()}catch(e){$({title:"Error",description:"Failed to delete coupon",type:"error"})}},K=e=>{q(e),V(!0)},Q=e=>e.isActive?new Date>new Date(e.expiryDate)?"bg-red-100 text-red-800":e.currentUsage>=e.maxUsageCount?"bg-orange-100 text-orange-800":"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",Y=e=>e.isActive?new Date>new Date(e.expiryDate)?"Expired":e.currentUsage>=e.maxUsageCount?"Fully Used":"Active":"Inactive",ee=s.filter(e=>e.couponCode===O);return h?(0,a.jsx)(d.i,{children:(0,a.jsx)(n.c,{currentPage:"/dashboard/coupons",children:(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})})}):(0,a.jsx)(d.i,{children:(0,a.jsx)(n.c,{currentPage:"/dashboard/coupons",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Coupon Management"}),(0,a.jsxs)("button",{onClick:()=>{R(),A(null),U(!0)},className:"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"Create Coupon"]})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Coupon Code"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Discount"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Usage"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Validity"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(m.Z,{className:"h-4 w-4 text-purple-500 mr-2"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.code}),e.minOrderValue&&(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["Min: ₹",e.minOrderValue]})]})]})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,a.jsx)("div",{className:"text-sm text-gray-900",children:"flat"===e.discountType?`₹${e.discountValue}`:`${e.discountValue}%`}),(0,a.jsx)("div",{className:"text-xs text-gray-500 capitalize",children:e.discountType})]}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-900",children:[e.currentUsage," / ",e.maxUsageCount]}),(0,a.jsx)("button",{onClick:()=>K(e.code),className:"ml-2 text-blue-600 hover:text-blue-800",children:(0,a.jsx)(y,{className:"h-4 w-4"})})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-1",children:(0,a.jsx)("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:`${e.currentUsage/e.maxUsageCount*100}%`}})})]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,a.jsx)(g.Z,{className:"h-4 w-4 mr-1"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{children:new Date(e.startDate).toLocaleDateString()}),(0,a.jsxs)("div",{children:["to ",new Date(e.expiryDate).toLocaleDateString()]})]})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${Q(e)}`,children:Y(e)})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:()=>X(e),className:"text-blue-600 hover:text-blue-800",children:(0,a.jsx)(f.Z,{className:"h-4 w-4"})}),(0,a.jsx)("button",{onClick:()=>G(e),className:`${e.isActive?"text-green-600 hover:text-green-800":"text-gray-400 hover:text-gray-600"}`,children:e.isActive?(0,a.jsx)(j,{className:"h-5 w-5"}):(0,a.jsx)(v,{className:"h-5 w-5"})}),(0,a.jsx)("button",{onClick:()=>J(e),className:"text-red-600 hover:text-red-800",children:(0,a.jsx)(N.Z,{className:"h-4 w-4"})})]})})]},e.id))})]})})}),(0,a.jsx)(x.u,{isOpen:S,onClose:()=>U(!1),title:T?"Edit Coupon":"Create New Coupon",className:"max-w-lg",children:(0,a.jsxs)("form",{onSubmit:P(B),className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Coupon Code *"}),(0,a.jsx)("input",{...L("code"),type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"e.g., WELCOME10",style:{textTransform:"uppercase"}}),F.code&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:F.code.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Discount Type *"}),(0,a.jsxs)("select",{...L("discountType"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",children:[(0,a.jsx)("option",{value:"",children:"Select Discount Type"}),D.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))]}),F.discountType&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:F.discountType.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Discount Value * ","percentage"===H?"(%)":"(₹)"]}),(0,a.jsx)("input",{...L("discountValue"),type:"number",min:"0",step:"percentage"===H?"1":"0.01",max:"percentage"===H?"100":void 0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"0"}),F.discountValue&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:F.discountValue.message})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date *"}),(0,a.jsx)("input",{...L("startDate"),type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"}),F.startDate&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:F.startDate.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Expiry Date *"}),(0,a.jsx)("input",{...L("expiryDate"),type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"}),F.expiryDate&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:F.expiryDate.message})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Min Order Value (₹)"}),(0,a.jsx)("input",{...L("minOrderValue"),type:"number",min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"0"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Usage Count *"}),(0,a.jsx)("input",{...L("maxUsageCount"),type:"number",min:"1",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"100"}),F.maxUsageCount&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:F.maxUsageCount.message})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>U(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:E,className:"px-4 py-2 text-sm font-medium text-white bg-purple-600 rounded-md hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed",children:E?"Saving...":T?"Update Coupon":"Create Coupon"})]})]})}),(0,a.jsx)(x.u,{isOpen:Z,onClose:()=>V(!1),title:`Usage Report: ${O}`,className:"max-w-2xl",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 bg-purple-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(b,{className:"h-5 w-5 text-purple-600 mr-2"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-purple-800",children:["Total Usage: ",ee.length," times"]})]}),(0,a.jsxs)("div",{className:"text-sm text-purple-600",children:["Total Saved: ₹",ee.reduce((e,t)=>e+.1*t.orderAmount,0).toLocaleString()]})]}),ee.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Customer"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Order Amount"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Used Date"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200",children:ee.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(w,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,a.jsx)("span",{className:"text-sm text-gray-900",children:e.customerName})]})}),(0,a.jsx)("td",{className:"px-4 py-2",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(k.Z,{className:"h-4 w-4 text-gray-400 mr-1"}),(0,a.jsxs)("span",{className:"text-sm text-gray-900",children:["₹",e.orderAmount.toLocaleString()]})]})}),(0,a.jsx)("td",{className:"px-4 py-2",children:(0,a.jsx)("span",{className:"text-sm text-gray-500",children:new Date(e.usedAt).toLocaleDateString()})})]},e.id))})]})}):(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(w,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-500",children:"No usage data found for this coupon."})]})]})})]})})})}},1047:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},9397:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},5868:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},8930:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])}},function(e){e.O(0,[2,151,566,971,117,744],function(){return e(e.s=4910)}),_N_E=e.O()}]);